#+TITLE: Education REST API examples
#+AUTHOR: Roman Rudakov
#+EMAIL: rrudakov@pm.me
* Users
** Register
#+begin_src restclient :async
POST http://127.0.0.1:3000/api/users
Content-Type: application/json
{
  "user_password": "123456",
  "user_email": "rrudakov@pm.me",
  "user_name": "rrudakov"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "message": "Resource already exist"
}
// POST http://127.0.0.1:3000/api/users
// HTTP/1.1 409 Conflict
// Content-Type: application/json; charset=utf-8
// Content-Length: 36
// Server: http-kit
// Date: Mon, 27 Apr 2020 19:25:41 GMT
// Request duration: 0.491134s
#+END_SRC
** Get all users
#+begin_src restclient
GET http://127.0.0.1:3000/api/users
Accept: application/json
Authorization: Token eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyIjp7ImlkIjo0LCJ1c2VybmFtZSI6InJydWRha292IiwiZW1haWwiOiJycnVkYWtvZkBwbS5tZSIsInJvbGVzIjpbImFkbWluIiwiZ3Vlc3QiXSwiY3JlYXRlZF9vbiI6IjIwMjAtMDUtMDdUMTU6MTM6MzZaIiwidXBkYXRlZF9vbiI6IjIwMjAtMDUtMDdUMTU6MTM6MzZaIn0sImV4cCI6MTU4OTI5NTE4Mn0.hWEpLCD7ephjQ3SltFLcMUFYi27zO9gNZBh0n55VULR_SrBBWiYTnSnE2OJUHhDyak9OZ2Au5VuPp5KdNa7sAA
#+end_src

#+RESULTS:
#+BEGIN_SRC js
[
  {
    "id": 4,
    "username": "rrudakov",
    "email": "rrudakof@pm.me",
    "roles": [
      "admin",
      "guest"
    ],
    "created_on": "2020-05-07T15:13:36Z",
    "updated_on": "2020-05-07T15:13:36Z"
  },
  {
    "id": 11,
    "username": "rrudakov2",
    "email": "rrudakov@pm.me2",
    "roles": [
      "admin",
      "moderator"
    ],
    "created_on": "2020-05-08T20:20:15Z",
    "updated_on": "2020-05-09T19:38:27Z"
  },
  {
    "id": 13,
    "username": "roma",
    "email": "rrudakov@pm.me",
    "roles": [
      "moderator"
    ],
    "created_on": "2020-05-11T13:25:42Z",
    "updated_on": "2020-05-11T13:26:48Z"
  }
]
// GET http://127.0.0.1:3000/api/users
// HTTP/1.1 200 OK
// Content-Type: application/json; charset=utf-8
// Content-Length: 463
// Server: http-kit
// Date: Mon, 11 May 2020 14:56:48 GMT
// Request duration: 0.013609s
#+END_SRC
** Get user by ID
#+begin_src restclient
GET http://127.0.0.1:3000/api/users/3
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "message": "User with id 3 not found!"
}
// GET http://127.0.0.1:3000/api/users/3
// HTTP/1.1 404 Not Found
// Content-Type: application/json; charset=utf-8
// Content-Length: 39
// Server: http-kit
// Date: Mon, 27 Apr 2020 17:46:37 GMT
// Request duration: 0.094216s
#+END_SRC

* Authentication
** Authentication
#+begin_src restclient :async t
POST http://127.0.0.1:3000/api/login
Content-Type: application/json
{
  "username": "rrudakov",
  "password": "123456"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "token": "eyJhbGciOiJIUzUxMiJ9.eyJ1c2VyIjp7ImlkIjo0LCJ1c2VybmFtZSI6InJydWRha292IiwiZW1haWwiOiJycnVkYWtvZkBwbS5tZSIsInJvbGVzIjpbImFkbWluIiwiZ3Vlc3QiXSwiY3JlYXRlZF9vbiI6IjIwMjAtMDUtMDdUMTU6MTM6MzZaIiwidXBkYXRlZF9vbiI6IjIwMjAtMDUtMDdUMTU6MTM6MzZaIn0sImV4cCI6MTU4OTI5NTE4Mn0.hWEpLCD7ephjQ3SltFLcMUFYi27zO9gNZBh0n55VULR_SrBBWiYTnSnE2OJUHhDyak9OZ2Au5VuPp5KdNa7sAA"
}
// POST http://127.0.0.1:3000/api/login
// HTTP/1.1 200 OK
// Content-Type: application/json; charset=utf-8
// Content-Length: 359
// Server: http-kit
// Date: Mon, 11 May 2020 14:53:02 GMT
// Request duration: 0.541608s
#+END_SRC

* Articles
** Get latest articles
#+begin_src restclient
GET http://127.0.0.1:3000/api/articles
Content-Type: application/edn
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "schema": "[{:id Int, :user_id Int, :title java.lang.String, :featured_image java.lang.String, :updated_on java.util.Date}]",
  "errors": [
    {
      "articles/updated_on": "disallowed-key",
      "articles/title": "disallowed-key",
      "updated_on": "missing-required-key",
      "title": "missing-required-key",
      "featured_image": "missing-required-key",
      "id": "missing-required-key",
      "articles/featured_image": "disallowed-key",
      "articles/id": "disallowed-key",
      "user_id": "missing-required-key",
      "articles/user_id": "disallowed-key"
    },
    {
      "articles/updated_on": "disallowed-key",
      "articles/title": "disallowed-key",
      "updated_on": "missing-required-key",
      "title": "missing-required-key",
      "featured_image": "missing-required-key",
      "id": "missing-required-key",
      "articles/featured_image": "disallowed-key",
      "articles/id": "disallowed-key",
      "user_id": "missing-required-key",
      "articles/user_id": "disallowed-key"
    },
    {
      "articles/updated_on": "disallowed-key",
      "articles/title": "disallowed-key",
      "updated_on": "missing-required-key",
      "title": "missing-required-key",
      "featured_image": "missing-required-key",
      "id": "missing-required-key",
      "articles/featured_image": "disallowed-key",
      "articles/id": "disallowed-key",
      "user_id": "missing-required-key",
      "articles/user_id": "disallowed-key"
    }
  ],
  "type": "compojure.api.exception/response-validation",
  "coercion": "schema",
  "value": [
    {
      "articles/id": 1,
      "articles/user_id": 4,
      "articles/title": "New article",
      "articles/featured_image": "https://google.photo",
      "articles/updated_on": "2020-05-10T19:00:08Z"
    },
    {
      "articles/id": 3,
      "articles/user_id": 4,
      "articles/title": "New article",
      "articles/featured_image": "https://google.photo",
      "articles/updated_on": "2020-05-10T19:32:46Z"
    },
    {
      "articles/id": 5,
      "articles/user_id": 11,
      "articles/title": "Some title",
      "articles/featured_image": "https://featured-image",
      "articles/updated_on": "2020-05-11T11:47:57Z"
    }
  ],
  "in": [
    "response",
    "body"
  ]
}
// GET http://127.0.0.1:3000/api/articles
// HTTP/1.1 500 Internal Server Error
// Content-Type: application/json; charset=utf-8
// Content-Length: 1797
// Server: http-kit
// Date: Mon, 11 May 2020 14:52:11 GMT
// Request duration: 0.058634s
#+END_SRC
